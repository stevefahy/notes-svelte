import{d as N,c as d,n as b,e as v,t as S,j as H,x as w,p as Z,s as p,b as ee,C as te,g as e,m as I,a as se,q as t,l as D,u as F,v as E,A as ae,D as W,E as L,F as Q,B as re,o as oe,G as P,y as ne}from"./index-CV3uTZ8I.js";import{b as R,E as le}from"./ErrorAlert-DT4a9BNt.js";import{c as ie,a as ue}from"./changeUsername-CAuEd94X.js";var de=w("<h2> </h2>"),ve=w('<h3 class="profile_email svelte-4pu6bu"> </h3>'),me=w("<div><!> <!></div>");function _e(h,m){var l=me(),f=v(l);{var i=r=>{var o=de(),s=v(o);S(()=>H(s,m.userName)),b(r,o)};N(f,r=>{m.userName&&r(i)})}var a=d(f,2);{var _=r=>{var o=ve(),s=v(o);S(()=>H(s,m.email)),b(r,o)};N(a,r=>{m.email&&r(_)})}b(h,l)}var ce=w('<div class="form_container svelte-17pe5kt"><form class="form svelte-17pe5kt"><div class="control svelte-17pe5kt"><label for="newUsername" class="svelte-17pe5kt">User name</label> <input type="text" id="newUsername" placeholder="New username" class="svelte-17pe5kt"/></div> <button type="submit" class="btn-contained svelte-17pe5kt">Change User Name</button></form></div>'),fe=w('<div class="form_container svelte-17pe5kt"><form class="form svelte-17pe5kt"><h3>Change Password</h3> <div class="control svelte-17pe5kt"><label for="oldPassword" class="svelte-17pe5kt">Current Password</label> <input type="password" id="oldPassword" class="svelte-17pe5kt"/></div> <div class="control svelte-17pe5kt"><label for="newPassword" class="svelte-17pe5kt">New Password</label> <input type="password" id="newPassword" class="svelte-17pe5kt"/></div> <button type="submit" class="btn-contained svelte-17pe5kt">Update Password</button></form></div>'),ge=w('<div class="change_buttons svelte-17pe5kt"><button type="button" class="btn-contained svelte-17pe5kt" aria-label="User Name button">User Name</button> <button type="button" class="btn-contained svelte-17pe5kt" aria-label="Password button">Password</button></div> <!> <!> <!>',1);function pe(h,m){Z(m,!0);let l=p(""),f=p(""),i=p(""),a=p(ee({error_state:!1,message:""})),_=p(!1),r=p(!1),o=p(!1);const s=ae,O=()=>{t(a,{error_state:!1,message:""},!0),t(r,!1),t(o,!1),t(f,""),t(i,""),t(l,m.userName??"",!0)},X=()=>{t(a,{error_state:!1,message:""},!0),t(o,!1),t(r,!e(r)),e(r)&&t(l,m.userName??"",!0)},Y=()=>{t(a,{error_state:!1,message:""},!0),t(r,!1),t(o,!e(o))},$=async n=>{n.preventDefault();const c=F(E).token;if(!c||!e(l).trim())return;if(e(l).length<s.USERNAME_MIN){t(a,{error_state:!0,message:s.CHANGE_USER_TOO_FEW},!0);return}if(e(l).length>s.USERNAME_MAX){t(a,{error_state:!0,message:s.CHANGE_USER_TOO_MANY},!0);return}if(e(l)===m.userName){t(a,{error_state:!0,message:s.CHANGE_USER_UNIQUE},!0);return}t(_,!0),t(a,{error_state:!1,message:""},!0);const u=W(await ie(c,{newUsername:e(l).trim()}));t(_,!1),u.ok?u.data.details&&(E.update(g=>({...g,details:u.data.details})),Q.ShowSnack({n_status:!0,message:"User name changed!"}),O()):L(u.error??s.GENERAL_ERROR)},j=async n=>{n.preventDefault();const c=F(E).token;if(!c)return;if(e(f)===e(i)){t(a,{error_state:!0,message:s.CHANGE_PASS_UNIQUE},!0);return}if(e(i).length<s.PASSWORD_MIN){t(a,{error_state:!0,message:s.CHANGE_PASS_TOO_FEW},!0);return}if(e(i).length>s.PASSWORD_MAX){t(a,{error_state:!0,message:s.CHANGE_PASS_TOO_MANY},!0);return}t(_,!0),t(a,{error_state:!1,message:""},!0);const u=W(await ue(c,{oldPassword:e(f),newPassword:e(i)}));t(_,!1),u.ok?(Q.ShowSnack({n_status:!0,message:"Password updated"}),O()):L(u.error??s.GENERAL_ERROR)};var y=ge(),T=te(y),G=v(T),q=d(G,2),x=d(T,2);{var B=n=>{var c=ce(),u=v(c),g=v(u),A=d(v(g),2),k=d(g,2);S(()=>k.disabled=e(_)),D("submit",u,$),R(A,()=>e(l),U=>t(l,U)),b(n,c)};N(x,n=>{e(r)&&n(B)})}var M=d(x,2);{var z=n=>{var c=fe(),u=v(c),g=d(v(u),2),A=d(v(g),2),k=d(g,2),U=d(v(k),2),V=d(k,2);S(()=>V.disabled=e(_)),D("submit",u,j),R(A,()=>e(f),C=>t(f,C)),R(U,()=>e(i),C=>t(i,C)),b(n,c)};N(M,n=>{e(o)&&n(z)})}var J=d(M,2);{var K=n=>{le(n,{get error_state(){return e(a).error_state},get message(){return e(a).message}})};N(J,n=>{e(a).error_state&&n(K)})}I("click",G,X),I("click",q,Y),b(h,y),se()}re(["click"]);var be=w('<div class="profile"><!> <!></div>');function ke(h){const m=()=>ne(E,"$authStore",l),[l,f]=oe(),i=P(m);var a=be(),_=v(a);{let o=P(()=>e(i)?.details?.username),s=P(()=>e(i)?.details?.email);_e(_,{get userName(){return e(o)},get email(){return e(s)}})}var r=d(_,2);{let o=P(()=>e(i)?.details?.username);pe(r,{get userName(){return e(o)},onChangePassword:s=>{},onChangeUsername:s=>{}})}b(h,a),f()}export{ke as default};
