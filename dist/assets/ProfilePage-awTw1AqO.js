import{d as N,c as d,m as b,e as v,t as S,j as H,w,p as V,s as p,b as Z,B as ee,g as e,a as te,o as t,l as I,q as D,u as E,A as se,C as F,D as W,E as L,z as ae,n as re,F as P,x as oe}from"./index-D-V4zERQ.js";import{b as R,E as ne}from"./ErrorAlert-G22uhqMO.js";import{c as le,a as ie}from"./changeUsername-B6NKFOrn.js";var ue=w("<h2> </h2>"),de=w('<h3 class="profile_email svelte-4pu6bu"> </h3>'),ve=w("<div><!> <!></div>");function _e(h,_){var l=ve(),f=v(l);{var i=r=>{var o=ue(),s=v(o);S(()=>H(s,_.userName)),b(r,o)};N(f,r=>{_.userName&&r(i)})}var a=d(f,2);{var m=r=>{var o=de(),s=v(o);S(()=>H(s,_.email)),b(r,o)};N(a,r=>{_.email&&r(m)})}b(h,l)}var me=w('<div class="form_container svelte-17pe5kt"><form class="form svelte-17pe5kt"><div class="control svelte-17pe5kt"><label for="newUsername" class="svelte-17pe5kt">User name</label> <input type="text" id="newUsername" placeholder="New username" class="svelte-17pe5kt"/></div> <button type="submit" class="btn-contained svelte-17pe5kt">Change User Name</button></form></div>'),ce=w('<div class="form_container svelte-17pe5kt"><form class="form svelte-17pe5kt"><h3>Change Password</h3> <div class="control svelte-17pe5kt"><label for="oldPassword" class="svelte-17pe5kt">Current Password</label> <input type="password" id="oldPassword" class="svelte-17pe5kt"/></div> <div class="control svelte-17pe5kt"><label for="newPassword" class="svelte-17pe5kt">New Password</label> <input type="password" id="newPassword" class="svelte-17pe5kt"/></div> <button type="submit" class="btn-contained svelte-17pe5kt">Update Password</button></form></div>'),fe=w('<div class="change_buttons svelte-17pe5kt"><button type="button" class="btn-contained svelte-17pe5kt" aria-label="User Name button">User Name</button> <button type="button" class="btn-contained svelte-17pe5kt" aria-label="Password button">Password</button></div> <!> <!> <!>',1);function ge(h,_){V(_,!0);let l=p(""),f=p(""),i=p(""),a=p(Z({error_state:!1,message:""})),m=p(!1),r=p(!1),o=p(!1);const s=se,O=()=>{t(a,{error_state:!1,message:""},!0),t(r,!1),t(o,!1),t(f,""),t(i,""),t(l,_.userName??"",!0)},Q=()=>{t(a,{error_state:!1,message:""},!0),t(o,!1),t(r,!e(r)),e(r)&&t(l,_.userName??"",!0)},X=()=>{t(a,{error_state:!1,message:""},!0),t(r,!1),t(o,!e(o))},Y=async n=>{n.preventDefault();const c=D(E).token;if(!c||!e(l).trim())return;if(e(l).length<s.USERNAME_MIN){t(a,{error_state:!0,message:s.CHANGE_USER_TOO_FEW},!0);return}if(e(l).length>s.USERNAME_MAX){t(a,{error_state:!0,message:s.CHANGE_USER_TOO_MANY},!0);return}if(e(l)===_.userName){t(a,{error_state:!0,message:s.CHANGE_USER_UNIQUE},!0);return}t(m,!0),t(a,{error_state:!1,message:""},!0);const u=F(await le(c,{newUsername:e(l).trim()}));t(m,!1),u.ok?u.data.details&&(E.update(g=>({...g,details:u.data.details})),L.ShowSnack({n_status:!0,message:"User name changed!"}),O()):W(u.error??s.GENERAL_ERROR)},$=async n=>{n.preventDefault();const c=D(E).token;if(!c)return;if(e(f)===e(i)){t(a,{error_state:!0,message:s.CHANGE_PASS_UNIQUE},!0);return}if(e(i).length<s.PASSWORD_MIN){t(a,{error_state:!0,message:s.CHANGE_PASS_TOO_FEW},!0);return}if(e(i).length>s.PASSWORD_MAX){t(a,{error_state:!0,message:s.CHANGE_PASS_TOO_MANY},!0);return}t(m,!0),t(a,{error_state:!1,message:""},!0);const u=F(await ie(c,{oldPassword:e(f),newPassword:e(i)}));t(m,!1),u.ok?(L.ShowSnack({n_status:!0,message:"Password updated"}),O()):W(u.error??s.GENERAL_ERROR)};var y=fe(),T=ee(y),x=v(T);x.__click=Q;var j=d(x,2);j.__click=X;var G=d(T,2);{var q=n=>{var c=me(),u=v(c),g=v(u),A=d(v(g),2),k=d(g,2);S(()=>k.disabled=e(m)),I("submit",u,Y),R(A,()=>e(l),U=>t(l,U)),b(n,c)};N(G,n=>{e(r)&&n(q)})}var M=d(G,2);{var z=n=>{var c=ce(),u=v(c),g=d(v(u),2),A=d(v(g),2),k=d(g,2),U=d(v(k),2),K=d(k,2);S(()=>K.disabled=e(m)),I("submit",u,$),R(A,()=>e(f),C=>t(f,C)),R(U,()=>e(i),C=>t(i,C)),b(n,c)};N(M,n=>{e(o)&&n(z)})}var B=d(M,2);{var J=n=>{ne(n,{get error_state(){return e(a).error_state},get message(){return e(a).message}})};N(B,n=>{e(a).error_state&&n(J)})}b(h,y),te()}ae(["click"]);var pe=w('<div class="profile"><!> <!></div>');function Ne(h){const _=()=>oe(E,"$authStore",l),[l,f]=re(),i=P(_);var a=pe(),m=v(a);{let o=P(()=>e(i)?.details?.username),s=P(()=>e(i)?.details?.email);_e(m,{get userName(){return e(o)},get email(){return e(s)}})}var r=d(m,2);{let o=P(()=>e(i)?.details?.username);ge(r,{get userName(){return e(o)},onChangePassword:s=>{},onChangeUsername:s=>{}})}b(h,a),f()}export{Ne as default};
