# Svelte App Audit — Summary of Changes and Pending Recommendations

## Implemented Changes

### 1. XSS Security Fix

**File:** `src/lib/markdown.ts`

- Set `html: false` in MarkdownIt configuration.
- Prevents raw HTML in user notes from being executed (e.g. `<script>`, `onerror` handlers).
- Safe for `welcome_markdown_angular.md` — custom containers (`::: custom`) are generated by plugins, not raw HTML.

### 2. Lazy-Load NotebookPage

**File:** `src/lib/router.ts`

- Changed `/notebook/:notebookId` from eager `component` to `asyncComponent` with dynamic import.
- NotebookPage is now loaded on demand, reducing initial bundle size.
- NotebookPage chunk is now separate (e.g. `NotebookPage-OlbRrj1W.js`).

### 3. LayoutComponent Notification Fix

**File:** `src/components/layout/LayoutComponent.svelte`

- Replaced manual `notificationStore.subscribe()` with `$effect` using `$notificationStore`.
- Added proper cleanup: `clearTimeout` in the effect return to avoid updates after unmount.
- Prevents memory leaks when the component unmounts before the 5-second timeout.

### 4. Rename vue-specific.scss

**Files:** `src/assets/styles/main.css`, `src/assets/styles/svelte-shared.scss` (new), `src/assets/styles/vue-specific.scss` (removed)

- Renamed `vue-specific.scss` to `svelte-shared.scss`.
- Updated import in `main.css`.
- Light pruning of commented-out blocks; all active styles kept for visual parity with other framework apps.

### 5. Consolidate Highlight.js Theme

**Files:** `src/assets/styles/main.css`, `src/components/note/ViewNoteMarkdown.svelte`

- Added global import of `highlight.js/styles/atom-one-dark.min.css` in `main.css`.
- Removed per-instance CDN link from `ViewNoteMarkdown.svelte` (no duplicate stylesheet loading).

### 6. NoteList $effect Fix

**File:** `src/components/note/NoteList.svelte`

- Added `prevClearNotesEdit` so the effect runs only when `onClearNotesEdit` transitions from false to true.
- Avoids repeated calls to `onNotesSelected` and potential feedback loops on parent re-renders.

---

## Recommendations Not Implemented

### Excluded for Cross-Framework Parity

These were intentionally not implemented so the Svelte app stays aligned with Vue, Angular, React, and Next.js.

| Recommendation | Reason |
|----------------|--------|
| **ViewNoteThumb lightweight preview** | Vue uses full ViewNoteMarkdown for thumbnails. A lightweight preview would make Svelte thumbnails look different. Revisit when all 5 apps are updated together. |
| **Replace confirm() with modal** | Vue has no delete confirmation; Svelte uses native `confirm()`. Adding a modal would introduce UI only in Svelte. Keeping native confirm preserves current behavior. |

### Explicitly Skipped

| Recommendation | Reason |
|----------------|--------|
| **Debounce markdown render** | User requested this not be implemented. Would reduce re-renders when typing in split-screen or view mode with editor. |

### Other Items from Original Audit

These were identified but not part of the Svelte-only plan or were lower priority:

| Item | Description |
|------|-------------|
| **Auth store auto-refresh** | `autoRefreshToken()` starts on module load. Could start the interval only after successful login/refresh. |
| **API error handling** | Consider a small `unwrapResponse` wrapper to centralize `{ error }` / `{ success }` checks. |
| **Duplicate showNotification** | `showNotification` is duplicated in multiple components; could derive from store or use a shared helper. |
| **Router type casting** | `as unknown as ComponentType` repeated for async routes; a typed helper could simplify this. |
| **Inline callback in NotebookPage** | `onNotesSelected={(s) => ...}` creates new function each render; minor optimization. |
| **External resources** | Google Fonts, Material Icons in `index.html`; could use `font-display: swap` or self-hosting. |

---

## Files Modified

- `src/lib/markdown.ts`
- `src/lib/router.ts`
- `src/components/layout/LayoutComponent.svelte`
- `src/components/note/NoteList.svelte`
- `src/components/note/ViewNoteMarkdown.svelte`
- `src/assets/styles/main.css`
- `src/assets/styles/svelte-shared.scss` (created)
- `src/assets/styles/vue-specific.scss` (deleted)
